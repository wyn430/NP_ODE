# NP_ODE
Implementation of our recent paper, [NP-ODE: Neural Process Aided Ordinary Differential Equations for Uncertainty Quantification of Finite Element Analysis](https://arxiv.org/abs/2012.06914)

## Abstract
Finite element analysis (FEA) has been widely used to generate simulations of complex and nonlinear systems. Despite its strength and accuracy, the limitations of FEA can be summarized into two aspects: a) running high-fidelity FEA often requires significant computational cost and consumes a large amount of time; b) FEA is a deterministic method that is insufficient for uncertainty quantification (UQ) when modeling complex systems with various types of uncertainties. In this paper, a physics-informed data-driven surrogate model, named Neural Process Aided Ordinary Differential Equation (NP-ODE), is proposed to model the FEA simulations and capture both input and output uncertainties. To validate the advantages of the proposed NP-ODE, we conduct experiments on both the simulation data generated from a given ordinary differential equation and the data collected from a real FEA platform for tribocorrosion. The performances of the proposed NP-ODE and several benchmark methods are compared. The results show that the proposed NP-ODE outperforms benchmark methods. The NP-ODE method realizes the smallest predictive error as well as generates the most reasonable confidence interval having the best coverage on testing data points.

## Citation

If you find our work useful in your research, please consider citing:

```
@misc{wang2020npode,
      title={NP-ODE: Neural Process Aided Ordinary Differential Equations for Uncertainty Quantification of Finite Element Analysis}, 
      author={Yinan Wang and Kaiwen Wang and Wenjun Cai and Xiaowei Yue},
      year={2020},
      eprint={2012.06914},
      archivePrefix={arXiv},
      primaryClass={cs.LG}
}
```

## Installation

The code has been tested on following environment

```
Ubuntu 18.04
python 3.6
CUDA 11.0
torch 1.4.0
scikit-learn 0.21.3
```

## Usage

### NP-ODE

train the NP-ODE on dataset generated by FEA method or sampled from spiral line.

```
CUDA_VISIBLE_DEVICES = ID python train.py [number of training samples] [unobserved samples in training] [input dimension] [output dimension] [dataset] [noise level]

e.g. CUDA_VISIBLE_DEVICES = 0 python train.py 30 10 7 1 fea 0
     CUDA_VISIBLE_DEVICES = 0 python train.py 150 30 3 2 spiral 0
```
Note that the parameter 'noise level' is only useful in dataset sampled from spiral line. The trained model is saved in directory ./runs.

test the NP-ODE on dataset generated by FEA method or sampled from spiral line

```
CUDA_VISIBLE_DEVICES = ID python test.py [number of training samples] [unobserved samples in training] [input dimension] [output dimension] [dataset] [noise level] [model directory]

e.g. CUDA_VISIBLE_DEVICES = 0 python test.py 30 10 7 1 fea 0 fea_range4_30_10
     CUDA_VISIBLE_DEVICES = 0 python test.py 150 30 3 2 spiral 0 spiral_range4_0.01

```
The predicted results are saved in directory ./results in .npz files.

Visualize the predicted results on spiral dataset.

```
python spiral_results_viz.py [noise level]

e.g. python spiral_results_viz.py [noise level]
```
Note that the current visualization is based on the pre-trained models uploaded in directory ./runs and hard coded in the script. If the user would like to use your own models, please edit the script to change the directory of model files.

Visualize the predicted results on FEA dataset. The saved results in .npz files should be copied and moved to directory ../Experiment_Results_Visualization. The visualization tool for FEA dataset is in the jupyter notebook "UQ_Visualization.ipynb" in the directory ../Experiment_Results_Visualization.

### Baseline Methods
One of the baseline methods is [Attentive Neural Process](https://arxiv.org/abs/1901.05761). The method has been modified to fit our datasets. The usage to train, test, and visualize the results is almost the same as our proposed NP-ODE.

The other baseline methods is Gaussian Process. The implementation of Gaussian Process is based on [scikit-learn](https://scikit-learn.org/stable/). Please refer to 

